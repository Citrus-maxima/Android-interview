## Q1: 什么是 PMS

PMS 是 Android 系统中的 Package Manager Service，主要负责应用的安装、卸载、权限控制等操作，是 Android 系统中非常重要的一个服务。

## Q2：Android 应用的安装过程是怎样的？

1. 用户点击安装包或从应用商店下载并安装应用。

2. 系统将应用安装包发送给 PMS。

3. 将安装包拷贝到/data/app下。
   
4. 检查当前安装包的状态，确保安装环境正常。

5. 解压应用包，并将应用数据、资源、代码等分别保存到不同的目录下。

6. 解析AndroidManifest.xml文件，验证应用是否具有正确的签名，并设置应用的权限等信息。

7. dex2oat操作，将apk中的dex文件转换为oat文件。

8. 将AndroidManifest文件解析出的组件、权限注册到PackageManagerService

9. 发送安装完成广播。

## Q3：Android 应用的卸载过程是怎样的？

1. 用户点击应用的卸载按钮或通过应用商店进行卸载。

2. 系统将卸载请求发送到 PMS。

3. PMS 停止应用的运行，并删除应用的数据、资源、代码等文件。

4. PMS 更新应用列表，将已卸载的应用从系统中移除。

5. 发送卸载广播。

## Q4：PMS 中的权限控制是怎样实现的？

PMS 中的权限控制通过权限管理和权限请求两个方面来实现。应用在 Android 系统中需要声明和请求权限，PMS 则会根据应用声明的权限和用户的选择来进行权限的管理和控制。

- 正常权限

这些权限不会直接涉及用户的隐私或敏感数据，通常不需要用户的明确授权。应用程序在清单文件中声明这些权限后，系统会自动授予它们。例如，访问网络状态、访问网络设置、访问文件系统等。

- 危险权限

这些权限涉及到用户的隐私和敏感数据，并且可能对用户造成潜在风险。应用程序在使用这些权限之前必须向用户请求权限，并得到用户的明确授权才能访问。例如，读取联系人、获取位置信息、拍照等。用户可以在应用安装或运行时选择是否授予这些权限。

- 签名权限

系统会在安装时授予这些应用程序权限，前提是请求该签名权限的应用程序与定义该权限的应用程序需要使用相同的证书签名。比如手机QQ 自定义了一个permission 且在权限标签中加入 android:protectionLevel=”signature”，而访问它的某个数据时，必须要拥有该权限。然后微信和 QQ 发布时采用相同的签名，微信就可以申请访问 QQ 中的此权限，并使用对应权限控制的数据。其他程序即使知道了这个开放数据的接口，也在 Manifest 注册了权限，但由于应用签名不同，还是无法访问的对应的数据。

- 特殊权限

这些权限是一些特殊功能或设备所需的权限，通常需要用户在系统设置中手动授权。例如，修改系统设置、更改电池优化设置、显示悬浮窗等。这些权限通常对用户的设备和数据具有更高级别的控制，因此用户必须明确授权才能使用它们。特殊权限与特定的应用操作相对应。只有平台和原始设备制造商 (OEM) 可以定义特殊权限。一般情况下：特殊权限大部分与系统签名文件同时使用。

## Q5：如何获取已安装应用的信息？

可以通过 PMS 提供的 PackageManager API 来获取已安装应用的信息，比如应用的名称、版本号、图标等。例如，可以通过以下代码获取所有已安装应用的 PackageInfo 信息：

PackageManager pm = context.getPackageManager();

List packages = pm.getInstalledPackages(0);

## Q6：如何安装非公开应用？

非公开应用需要用户手动打开“允许安装来自未知来源的应用”选项才能安装，这可以在系统设置的“安全”选项中进行设置。再次安装应用时，系统会提示用户是否允许非公开应用的安装，并让用户选择是否启用“未知来源”的应用进行安装。
